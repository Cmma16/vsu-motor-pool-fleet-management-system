import{j as e,q as b,m as c,$ as I,t as f}from"./app-CLKafMi8.js";import{D as R}from"./data-table-C7dLI7r4.js";import{D as N}from"./destructive-dialog-xP37ESc7.js";import{B as n}from"./badge-C6hRO3uT.js";import{B as r}from"./button-BjJxCl2U.js";import{H as p,I as x,J as g,K as j,S,A as T}from"./app-layout-DVg1ib_u.js";import{c as A,A as D}from"./index-DJgH2Ra1.js";import{P as V,I as F}from"./printer-BelALEIQ.js";import{P as _}from"./pencil-DTvOLnSC.js";import{T as w}from"./trash-CJg2OzLV.js";import{c as y}from"./createLucideIcon-BqkyE-xM.js";import{W as v}from"./wrench-BvQdNsdS.js";import{f as k}from"./format-Dc8-h87M.js";import{C as P,a as $,b as B,d as H}from"./card-DGsM5wb-.js";import"./index-BCvKXVy8.js";import"./table-BlADWfi2.js";import"./app-logo-icon-Duf-p-hV.js";import"./data-table-toolbar-B2mgQWHI.js";import"./input-BZPmkLvt.js";import"./select-Dh-P3SFY.js";import"./index-DDbGhVyI.js";import"./index-CbVnBepr.js";import"./index-DOfCkWky.js";import"./index-d59M3VVJ.js";import"./plus-DTrtCI9I.js";import"./index-YJI3hRqt.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M22 12A10 10 0 1 1 12 2",key:"1fm58d"}],["path",{d:"M22 2 12 12",key:"yg2myt"}],["path",{d:"M16 2h6v6",key:"zan5cs"}]],C=y("CircleArrowOutUpRight",L);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],q=y("FileWarning",z);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m16 16-1.9-1.9",key:"1dq9hf"}]],M=y("ScanSearch",E);function O(t){switch(t){case"pending":return e.jsx(n,{variant:"outline",className:"bg-gray-100",children:"Pending"});case"received":return e.jsx(n,{variant:"default",className:"bg-blue-500",children:"Received"});case"inspected":return e.jsx(n,{variant:"default",className:"bg-yellow-500",children:"Inspected"});case"approved":return e.jsx(n,{variant:"default",className:"bg-green-500",children:"Approved"});case"cancelled":return e.jsx(n,{variant:"default",className:"bg-red-500",children:"Cancelled"});case"conducted":return e.jsx(n,{variant:"default",className:"bg-purple-500",children:"Conducted"});case"completed":return e.jsx(n,{variant:"default",className:"bg-green-600",children:"Completed"});default:return e.jsx(n,{variant:"outline",className:"bg-gray-200",children:t})}}function W(t){switch(t){case"repair":return e.jsx(n,{variant:"outline",className:"bg-green-500",children:"Repair"});case"maintenance":return e.jsx(n,{variant:"outline",className:"bg-yellow-500",children:"Maintenance"});case"preventive":return e.jsx(n,{variant:"outline",className:"bg-blue-400",children:"Preventive"})}}const u=A(),U=(t,o,h,l)=>[{id:"select",enableSorting:!1,enableHiding:!1},u.accessor("vehicle_name",{header:({column:a})=>e.jsxs(r,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),children:["Vehicle",e.jsx(D,{className:"ml-2 h-4 w-4"})]}),cell:a=>{const s=a.getValue()||"",d=15,m=s.length>d?s.slice(0,d)+"...":s;return e.jsx("div",{className:"text-left",children:m})}}),u.accessor("requested_by",{header:()=>e.jsx("div",{className:"text-left",children:"Requested by"}),cell:a=>e.jsx("div",{className:"text-left",children:a.getValue()})}),u.accessor("date_filed",{header:()=>e.jsx("div",{className:"text-left",children:"Date filed"}),cell:a=>e.jsx("div",{className:"text-left",children:k(a.getValue(),"yyyy-MM-dd")})}),u.accessor("service_type",{header:()=>e.jsx("div",{className:"text-left",children:"Service type"}),cell:a=>e.jsx("div",{className:"text-left",children:W(a.getValue())})}),u.accessor("work_description",{header:()=>e.jsx("div",{className:"text-left",children:"Requested work description"}),cell:a=>{const s=a.getValue()||"",d=20,m=s.length>d?s.slice(0,d)+"...":s;return e.jsx("div",{className:"text-left",children:m})}}),u.accessor("status",{header:()=>e.jsx("div",{className:"text-left",children:"Status"}),cell:a=>e.jsx("div",{className:"text-left",children:O(a.getValue())})}),{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),cell:({row:a})=>{const s=a.original,d=()=>{s.service_type==="maintenance"?c.get(route("maintenance.show",{maintenance_id:s.maintenance_id})):s.service_type==="repair"?c.get(route("repairs.show",{maintenance_id:s.maintenance_id})):c.get(route("preventive.show",{maintenance_id:s.maintenance_id}))},{auth:i}=b().props;return e.jsxs(e.Fragment,{children:[s.status==="completed"&&e.jsx(r,{onClick:()=>window.open(`/services/requests/${s.request_id}/pdf`,"_blank"),className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-800",children:e.jsx(V,{})}),i.user.role.name==="Driver"&&e.jsxs(e.Fragment,{children:[s.status==="pending"&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(r,{className:"bg-yellow-300 text-black hover:bg-yellow-400",onClick:()=>o(s.request_id),children:e.jsx(_,{})}),e.jsx(N,{icon:w,iconOnly:!0,description:"This action cannot be undone. This will permanently delete your request.",action:()=>h(s.request_id)})]}),s.status==="received"&&e.jsx("div",{className:"flex justify-center gap-2"})]}),i.user.role.name==="Mechanic"&&e.jsxs(e.Fragment,{children:[s.status==="received"&&e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(p,{children:e.jsxs(x,{children:[e.jsx(g,{asChild:!0,children:e.jsx(r,{className:"bg-yellow-300 text-black hover:bg-yellow-400",onClick:()=>c.get(route("request-inspections.create",{data:{requestId:s.request_id}})),children:e.jsx(M,{})})}),e.jsx(j,{children:e.jsx("p",{children:"Inspect request"})})]})})}),s.status==="approved"&&e.jsxs("div",{className:"flex justify-center gap-2",children:[s.service_type==="repair"&&e.jsx(r,{className:"bg-green-300 text-black hover:bg-green-400",onClick:()=>c.get(route("repairs.create",{data:{requestId:s.request_id,vehicleId:s.vehicle_id}})),children:e.jsx(v,{})}),s.service_type==="maintenance"&&e.jsx(r,{className:"bg-green-300 text-black hover:bg-green-400",onClick:()=>c.get(route("maintenance.create",{data:{requestId:s.request_id,vehicleId:s.vehicle_id,planId:s.plan_id}})),children:e.jsx(v,{})}),s.service_type==="preventive"&&e.jsx(r,{className:"bg-green-300 text-black hover:bg-green-400",onClick:()=>c.get(route("preventive.create",{data:{requestId:s.request_id,vehicleId:s.vehicle_id}})),children:e.jsx(v,{})})]})]}),(i.user.role.name==="Manager"||i.user.role.name==="Admin")&&e.jsxs(e.Fragment,{children:[s.status==="pending"&&e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(r,{className:"bg-yellow-300 text-black hover:bg-yellow-400",onClick:()=>l(s.request_id,"received"),children:"Receive"})}),s.status==="inspected"&&e.jsx("div",{className:"flex justify-center gap-2",children:s.inspection_confirmed?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"bg-green-300 text-black hover:bg-green-400",onClick:()=>l(s.request_id,"approved"),children:"Approve"}),e.jsx(r,{className:"bg-red-300 text-black hover:bg-red-400",onClick:()=>l(s.request_id,"rejected"),children:"Reject"})]}):e.jsx(p,{children:e.jsxs(x,{children:[e.jsx(g,{asChild:!0,children:e.jsx(r,{onClick:()=>c.get(route("request-inspections.show",{inspection_id:s.inspection_id})),className:"bg-amber-300",variant:"outline",children:e.jsx(q,{})})}),e.jsx(j,{children:e.jsx("p",{children:"Inspection is not confirmed, click here to confirm"})})]})})}),s.status==="conducted"&&e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(p,{children:e.jsxs(x,{children:[e.jsx(g,{asChild:!0,children:e.jsx(r,{onClick:d,className:"bg-amber-300",variant:"outline",children:e.jsx(C,{})})}),e.jsx(j,{children:e.jsx("p",{children:"Maintenance/repair record unconfirmed, click here to view"})})]})})})]})]})}}],J=({request:t,handleEdit:o,handleDelete:h,handleStatusUpdate:l})=>{const{auth:a}=b().props,s=a.user.role.name,d=()=>{t.service_type==="maintenance"?c.get(route("maintenance.show",{maintenance_id:t.maintenance_id})):c.get(route("repairs.show",{maintenance_id:t.maintenance_id}))};return e.jsxs("div",{className:"mt-2 flex flex-wrap justify-start gap-2",children:[s==="Driver"&&t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"bg-yellow-300 text-black hover:bg-yellow-400",onClick:()=>o(t.request_id),children:e.jsx(_,{})}),e.jsx(N,{icon:w,iconOnly:!0,description:"This action cannot be undone. This will permanently delete your request.",action:()=>h(t.request_id)})]}),s==="Mechanic"&&t.status==="received"&&e.jsx(p,{children:e.jsxs(x,{children:[e.jsx(g,{asChild:!0,children:e.jsx(r,{className:"bg-yellow-300 text-black hover:bg-yellow-400",onClick:()=>c.get(route("request-inspections.create",{data:{requestId:t.request_id}})),children:e.jsx(M,{})})}),e.jsx(j,{children:e.jsx("p",{children:"Inspect request"})})]})}),s==="Mechanic"&&t.status==="approved"&&e.jsx(e.Fragment,{children:["repair","maintenance","preventive"].includes(t.service_type)&&e.jsx(r,{className:"bg-green-300 text-black hover:bg-green-400",onClick:()=>{const i=t.service_type==="repair"?"repairs":t.service_type;c.get(route(`${i}.create`,{data:{requestId:t.request_id,vehicleId:t.vehicle_id,...t.plan_id&&{planId:t.plan_id}}}))},children:e.jsx(v,{})})}),(s==="Manager"||s==="Admin")&&t.status==="pending"&&e.jsx(r,{className:"bg-yellow-300 text-black hover:bg-yellow-400",onClick:()=>l(t.request_id,"received"),children:"Receive"}),(s==="Manager"||s==="Admin")&&t.status==="inspected"&&e.jsx(e.Fragment,{children:t.inspection_confirmed?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"bg-green-300 text-black hover:bg-green-400",onClick:()=>l(t.request_id,"approved"),children:"Approve"}),e.jsx(r,{className:"bg-red-300 text-black hover:bg-red-400",onClick:()=>l(t.request_id,"rejected"),children:"Reject"})]}):e.jsx(p,{children:e.jsxs(x,{children:[e.jsx(g,{asChild:!0,children:e.jsx(r,{onClick:()=>c.get(route("request-inspections.show",{inspection_id:t.inspection_id})),className:"bg-amber-300",variant:"outline",children:e.jsx(q,{})})}),e.jsx(j,{children:e.jsx("p",{children:"Inspection not confirmed â€” click to view"})})]})})}),s==="Manager"&&t.status==="conducted"&&e.jsx(p,{children:e.jsxs(x,{children:[e.jsx(g,{asChild:!0,children:e.jsx(r,{onClick:d,className:"bg-amber-300",variant:"outline",children:e.jsx(C,{})})}),e.jsx(j,{children:e.jsx("p",{children:"View unconfirmed maintenance/repair"})})]})})]})};function K(t){switch(t){case"pending":return e.jsx(n,{variant:"outline",className:"bg-gray-100",children:"Pending"});case"received":return e.jsx(n,{variant:"default",className:"bg-blue-500",children:"Received"});case"inspected":return e.jsx(n,{variant:"default",className:"bg-yellow-500",children:"Inspected"});case"approved":return e.jsx(n,{variant:"default",className:"bg-green-500",children:"Approved"});case"cancelled":return e.jsx(n,{variant:"default",className:"bg-red-500",children:"Cancelled"});case"conducted":return e.jsx(n,{variant:"default",className:"bg-purple-500",children:"Conducted"});case"completed":return e.jsx(n,{variant:"default",className:"bg-green-600",children:"Completed"});default:return e.jsx(n,{variant:"outline",className:"bg-gray-200",children:t})}}const Z=({request:t,onEdit:o,onDelete:h,onStatusUpdate:l})=>e.jsxs(P,{className:"m-2 w-full",children:[e.jsx($,{className:"flex flex-row items-start justify-between space-y-0",children:e.jsxs("div",{children:[e.jsx(B,{className:"text-base",children:t.vehicle_name}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Requested by ",t.requested_by]})]})}),e.jsxs(H,{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date Filed:"})," ",k(t.date_filed,"LLL dd, yyyy")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Service Type:"})," ",t.service_type]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Description:"})," ",t.work_description]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",e.jsx("span",{children:K(t.status)})]}),e.jsx(J,{request:t,handleEdit:o,handleDelete:h,handleStatusUpdate:l})]})]}),G=[{title:"Service Requests",href:"/services/requests"}],Q={title:"Service Requests",description:"Manage your service requests"};function we({serviceRequests:t}){const o=b().props.auth.user,h=S(),l=i=>{c.delete(route("requests.destroy",{id:i}),{onSuccess:()=>{f.success("Service request deleted")},onError:()=>{f.error("Service request deletion failed")}})},a=i=>{c.get(route("requests.show",{id:i}))},s=i=>{c.get(route("requests.edit",{id:i}))},d=(i,m)=>{c.patch(route("requests.updateStatus",i),{status:m},{onSuccess:()=>{f.success(`Service request ${m}`,{description:"Service request status updated successfully"})},onError:()=>{f.error("Service request status update failed",{description:"Please try again"})},onFinish:()=>{c.reload()}})};return e.jsxs(T,{breadcrumbs:G,pageDetails:Q,children:[e.jsx(I,{title:"Repairs"}),e.jsxs("div",{className:"mx-4",children:[e.jsx("h2",{className:"mb-2 text-lg font-semibold",children:"Important Information"}),e.jsxs("div",{className:"mb-2 flex items-start gap-2 rounded-md bg-blue-50 p-4 text-blue-800",children:[e.jsx(v,{className:"mt-0.5 h-5 w-5 text-blue-400"}),e.jsx("span",{children:"Repair/maintenance process: A request must be received by the Manager before it can be inspected by the Mechanic. Once approved, the Mechanic can start conducting the repair/maintenance."})]}),e.jsxs("div",{className:"flex items-start gap-2 rounded-md bg-green-50 p-4 text-green-800",children:[e.jsx(F,{className:"mt-0.5 h-5 w-5 text-green-400"}),e.jsx("span",{children:"Requestors can only edit their own pending requests. Only the Managers and Admin can approve requests."})]})]}),e.jsx("div",{className:"flex h-full w-full max-w-full flex-1 flex-col gap-2 rounded-xl p-2 sm:gap-4 sm:p-4",children:e.jsx("div",{className:"w-full max-w-full overflow-x-auto rounded-lg",children:h?e.jsx("div",{className:"flex flex-col gap-2",children:t.map(i=>e.jsx(Z,{request:i,onEdit:s,onDelete:l,onStatusUpdate:d}))}):e.jsx(R,{columns:U,data:t,handleCreate:o.role.name==="Driver"?route("requests.create"):null,handleView:a,handleEdit:s,handleDelete:l,handleStatusUpdate:d,filterColumn:"vehicle_name",placeholder:"Search vehicle name"})})})]})}export{we as default};
