import{R as M,j as e,v as F,$ as q,t as R}from"./app-dmRk_xSF.js";import{I as c}from"./input-error-BIGrXHCO.js";import{O as I}from"./odometer-log-modal-BYge-9rx.js";import{B as g}from"./badge-DEZpwE8-.js";import{B as T}from"./button-DfRWLWLh.js";import{I as b}from"./input-uEZiaGVz.js";import{L as l}from"./label-tcdczQa9.js";import{S as N,a as y,b as f,c as S,d as C}from"./select-DTbPtvM0.js";import{T as V}from"./textarea-ENukNeqr.js";import{C as E,a as A,b as B,c as $,d as L}from"./card-4lmChtC_.js";import{A as z}from"./app-layout-CvTHScm8.js";import"./app-logo-icon-DPhwaTiD.js";import"./odometer-log-form-Dz18aUlL.js";import"./index-DS_s7J1F.js";import"./index-Cymawgta.js";import"./createLucideIcon-C6Zxls1X.js";import"./index-BzxzypMb.js";import"./index-Dnf0Jnlg.js";import"./index-C9jObI59.js";import"./wrench-D44s-QhF.js";function H({formData:s,formType:p,setData:n,onSubmit:u,processing:r,errors:d,vehicles:o,serviceRequests:x,odometerLogs:m,maintenancePlans:j,lockInputs:t}){const i=M.useMemo(()=>{const a=Number(s.vehicle_id);return m.filter(h=>h.vehicle_id===a).sort((h,_)=>new Date(_.created_at)-new Date(h.created_at))[0]},[s.vehicle_id,m]);return M.useEffect(()=>{i?n("odometer_id",i.odometer_id):n("odometer_id","")},[i]),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"vehicle_id",children:["Vehicle ",e.jsx("span",{className:"text-red-500",children:"*"}),t&&e.jsx(g,{variant:"outline",className:"ml-2",children:"Read only"})]}),e.jsxs(N,{disabled:t,value:String(s.vehicle_id),onValueChange:a=>n("vehicle_id",Number(a)),children:[e.jsx(y,{id:"vehicle_id",tabIndex:1,className:"mt-2 disabled:opacity-100",children:e.jsx(f,{placeholder:"Select vehicle"})}),e.jsx(S,{children:o.map(a=>e.jsx(C,{value:String(a.vehicle_id),children:a.vehicle_name},a.vehicle_id))})]}),e.jsx(c,{message:d.vehicle_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"request_id",children:["Request Description ",e.jsx("span",{className:"text-red-500",children:"*"}),t&&e.jsx(g,{variant:"outline",className:"ml-2",children:"Read only"})]}),e.jsxs(N,{disabled:t,value:String(s.request_id),onValueChange:a=>n("request_id",Number(a)),children:[e.jsx(y,{id:"request_id",tabIndex:2,className:"mt-2 disabled:opacity-100",children:e.jsx(f,{placeholder:"Select service request"})}),e.jsx(S,{children:x.map(a=>e.jsx(C,{value:String(a.request_id),children:a.work_description},a.request_id))})]}),e.jsx(c,{message:d.request_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"plan_id",children:["Maintenance Plan ",e.jsx("span",{className:"text-red-500",children:"*"}),t&&e.jsx(g,{variant:"outline",className:"ml-2",children:"Read only"})]}),e.jsxs(N,{disabled:t,value:String(s.plan_id),onValueChange:a=>n("plan_id",Number(a)),children:[e.jsx(y,{id:"plan_id",tabIndex:1,className:"mt-2 disabled:opacity-100",children:e.jsx(f,{placeholder:"Select maintenance plan"})}),e.jsx(S,{children:j.map(a=>e.jsx(C,{value:String(a.plan_id),children:`${a.vehicle_name} - ${a.scheduled_date}`},a.plan_id))})]}),e.jsx(c,{message:d.plan_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"date_in",children:["Date In ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(b,{id:"date_in",type:"date",value:s.date_in,onChange:a=>n("date_in",a.target.value),disabled:r,tabIndex:4,className:"mt-2"}),e.jsx(c,{message:d.date_in})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"date_completed",children:["Date Completed ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(b,{id:"date_completed",type:"date",value:s.date_completed,onChange:a=>n("date_completed",a.target.value),disabled:r,tabIndex:5,className:"mt-2"}),e.jsx(c,{message:d.date_completed})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"maintenance_summary",children:["Summary ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"maintenance_summary",name:"maintenance_summary",placeholder:"Description of the maintenance conducted",value:s.maintenance_summary,onChange:a=>n("maintenance_summary",a.target.value),disabled:r,tabIndex:6,className:"mt-2 min-h-[120px] resize-y rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:outline-none"}),e.jsx(c,{message:d.maintenance_summary})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"odometer_id",children:["Odometer Reading ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(b,{className:"mt-2 bg-gray-100",value:(i==null?void 0:i.reading)??"",disabled:!0,placeholder:"No odometer reading available"}),s.vehicle_id&&e.jsx(I,{latestReading:(i==null?void 0:i.reading)??0,vehicles:o,formType:"add",vehicle_id:s.vehicle_id}),e.jsx(c,{message:d.odometer_id})]})]}),e.jsx(T,{disabled:r,className:"w-1/3",children:p==="edit"?"Save Changes":"Add Maintenance"})]})}const P=[{title:"Maintenance",href:"/maintenance"},{title:"New maintenance",href:"/maintenance/add-maintenance"}],G={title:"Vehicle Maintenance Record",description:"Record the details of a vehicle maintenance."};function me({maintenancePlans:s,vehicles:p,users:n,serviceRequests:u,odometerLogs:r,requestId:d,vehicleId:o,planId:x}){const{data:m,setData:j,post:t,processing:i,errors:a,reset:h}=F({plan_id:x||"",vehicle_id:o||"",request_id:d||"",date_in:"",date_completed:"",odometer_id:"",performed_by:"",confirmed_by:"",date_confirmed:"",maintenance_summary:""}),_=w=>{console.log(m),w.preventDefault();const v={...m};delete v.vehicle_id,delete v.plan_id,t(route("maintenance.store"),{data:v,onSuccess:()=>{R.success("Maintenance recorded",{description:"Maintenance record created successfully"}),h()},onError:J=>{R.error("Failed to create maintenance record")}})};return e.jsxs(z,{breadcrumbs:P,pageDetails:G,children:[e.jsx(q,{title:"Maintenance"}),e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsxs(E,{className:"m-4 w-full max-w-2xl rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs(A,{children:[e.jsx(B,{children:"Maintenance Information"}),e.jsx($,{children:"Enter the details of the maintenance conducted."})]}),e.jsx(L,{children:e.jsx(H,{formData:m,formType:"add",setData:j,onSubmit:_,processing:i,errors:a,vehicles:p,users:n,serviceRequests:u,odometerLogs:r,maintenancePlans:s,lockInputs:d&&o&&x})})]})})]})}export{me as default};
